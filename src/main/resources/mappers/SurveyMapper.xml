<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="survey">

    <!-- 설문 제출 -->
    <insert id="insertSurveyInfo" parameterType="com.cafe24.craneform.dto.SurveyInfoDTO">
        <![CDATA[
            INSERT INTO survey_info_tb (si_ui_no, si_subtitle, si_detail, si_start_date, si_end_date, si_state)
            VALUES (#{si_ui_no}, #{si_subtitle}, #{si_detail}, now(), #{si_end_date}, #{si_state})
        ]]>
    </insert>

    <!-- 질문 제출 -->
    <insert id="insertQuestion" parameterType="com.cafe24.craneform.dto.QuestionDTO">
        <![CDATA[
            INSERT INTO question_tb (qs_si_no, qs_type, qs_detail, qs_required, qs_order)
            VALUES (#{qs_si_no}, #{qs_type}, #{qs_detail}, #{qs_required}, #{qs_order})
        ]]>
    </insert>

    <!-- 옵션 제출 -->
    <insert id="insertSelectOption" parameterType="com.cafe24.craneform.dto.SelectOptionDTO">
        <![CDATA[
            INSERT INTO select_option_tb (so_qs_no, so_detail, so_order)
            VALUES (#{so_qs_no}, #{so_detail}, #{so_order})
        ]]>
    </insert>

    <!-- 방금 insert한 설문 번호 검색 -->
    <select id="searchSurveyNo" parameterType="com.cafe24.craneform.dto.SurveyInfoDTO" resultType="int">
        <![CDATA[
            SELECT si_no FROM survey_info_tb
            WHERE si_ui_no = #{si_ui_no}
            ORDER BY si_no DESC
            LIMIT 1
        ]]>
    </select>

    <!-- 방금 insert한 질문 번호 검색 -->
    <select id="searchQuestionNo" parameterType="com.cafe24.craneform.dto.QuestionDTO" resultType="int">
        <![CDATA[
            SELECT qs_no FROM question_tb
            WHERE qs_si_no = #{qs_si_no} AND qs_order = #{qs_order}
            ORDER BY qs_no DESC
            LIMIT 1
        ]]>
    </select>

    <!-- index 설문 목록 표시 -->
    <select id="surveyInfoList" resultType="com.cafe24.craneform.dto.SurveyInfoDTO">
        <![CDATA[
            SELECT si_no, si_ui_no, si_created_date, si_detail, si_start_date, si_end_date, si_state, si_subtitle
            FROM survey_info_tb
            ORDER BY si_no DESC
        ]]>
    </select>

    <!-- 설문 상세 -->
    <select id="surveyInfoOne" parameterType="int" resultType="com.cafe24.craneform.dto.SurveyInfoDTO">
        <![CDATA[
            SELECT si_no, si_ui_no, si_created_date, si_detail, si_start_date, si_end_date, si_state, si_subtitle
            FROM survey_info_tb
            WHERE si_no = #{si_no}
        ]]>
    </select>

    <!-- 설문지 상세에 질문 리스트 -->
    <select id="questionList" parameterType="int" resultType="com.cafe24.craneform.dto.QuestionDTO">
        <![CDATA[
            SELECT qs_no, qs_si_no, qs_type, qs_detail, qs_required, qs_order
            FROM question_tb
            WHERE qs_si_no = ${si_no}
        ]]>
    </select>

    <!-- 설문지 상세에 객관식 옵션 리스트 -->
    <select id="selectOptionList" parameterType="int" resultType="com.cafe24.craneform.dto.SelectOptionDTO">
        <![CDATA[
            SELECT so_no, so_qs_no, so_detail, so_order
            FROM select_option_tb so JOIN question_tb qs
            ON so.so_qs_no = qs.qs_no
            WHERE qs.qs_si_no = #{si_no}
        ]]>
    </select>
</mapper>
